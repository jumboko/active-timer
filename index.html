<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>活動記録タイマー</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- ヘッダー表示 -->
  <header id="mainHeader">
    <div id="headerInner">
      <div id="homeButton">
        <button class="btn-auth" onclick="showPage('homePage')">🏠ホーム</button>
      </div>
      <div id="logoArea">
        <div class="titleLine"><ruby>活動記録<rt>かつどうきろく</rt></ruby></div>
        <div class="titleLine">タイマー</div>
      </div>
      <div id="authStatus">
        <button class="btn-auth" onclick="loginWithGoogle()">ログイン</button>
        <button class="btn-auth" onclick="logout()" style="display: none;">ログアウト</button>
        <div id="userInfo" style="display: none;">
          ログイン中：<span class="emailText">user@example.com</span> <!-- ユーザ情報 -->
          <span class="tooltip">user@example.com</span> <!-- ツールチップ用 -->
        </div>
      </div>
    </div>
  </header>

  <!-- トップ画面 -->
  <div id="homePage" class="page active">
    <button class="btn-main" onclick="showPage('actHistoryPage');">
      <ruby>記録確認<rt>きろくかくにん</rt></ruby>
    </button>
    <button class="btn-main" onclick="showPage('actSelectPage')">
      <ruby>活動<rt>かつどう</rt></ruby>を<ruby>記録<rt>きろく</rt></ruby>
    </button>
    <!-- バックアップ・インポート・ファイル選択エリア -->
    <div id="backupArea">
      <button class="btn-sub" onclick="downloadBackup()">バックアップ</button>
      <button class="btn-sub" onclick="document.getElementById('importFile').click()">インポート</button>
      <input type="file" id="importFile" accept="application/json" style="display:none" onchange="handleImportFile(event)" />
    </div>
  </div>

  <!-- 活動選択画面 -->
  <div id="actSelectPage" class="page">
    <h2><ruby>活動<rt>かつどう</rt></ruby>を<ruby>選択<rt>せんたく</rt></ruby></h2>
    <div class="selectControls">
      <input type="text" id="newActivity" maxlength="20" placeholder="新しい活動名"/>
      <label id="recordOrderLabel" for="recordOrder">並び順 ：</label>
        <select id="recordOrder">
          <option value="asc" selected>最短記録順</option>
          <option value="desc">最長記録順</option>
        </select>
      <button class="btn-select" onclick="addActivityBL()"><ruby>追加<rt>ついか</rt></ruby></button>
    </div>
    <ul id="actSelectList"></ul>
    <button class="btn-nav" onclick="showPage('homePage')">← <ruby>戻<rt>もど</rt></ruby>る</button>
  </div>

  <!-- タイマー画面 -->
  <div id="timerPage" class="page">
    <div id="timerLayout">
      <!-- 左側：タイマー -->
      <div class="timerColumn">
        <h2 id="timerTitle">活動名のタイマー</h2>
        <div id="timeWrapper">
          <!-- ベクター形式の描画 -->
          <!-- viewBox(横400 × 縦130の図形で固定 ※CSSで幅を伸縮させるがSVG内部の長さは固定) -->
          <svg id="progressRect" viewBox="-5 -5 410 140" preserveAspectRatio="none"><!-- preserveAspectRatio(アスペクト比の挙動指定 ※noneは不均等) -->
            <!-- path(自由描画), M(始点x/y), H(水平方向x), V(垂直方向y), Q(2次ベジェ曲線、引っ張る座標と終点座標を指定) -->
            <!-- stroke(枠線色), stroke-width(線幅), fill(塗りつぶし色), vector-effect(non-scaling-strokeで線幅を固定) -->
            <path d="M200,0
                     H380 Q400,0 400,20
                     V110 Q400,130 380,130
                     H20  Q0,130 0,110
                     V20  Q0,0   20,0
                     H200"
                  stroke="#f4a261" stroke-width="10" fill="#fff3c4" vector-effect="non-scaling-stroke"/>
            <!-- 進捗バー(緑で時計回りに進む) -->
            <!-- stroke-linecap(線の始点終点の形), stroke-dasharray(線の点線幅を指定), stroke-dashoffset(点線の始点位置を変更) -->
            <path id="progressFrame"
                  d="M200,0
                     H380 Q400,0 400,20
                     V110 Q400,130 380,130
                     H20  Q0,130 0,110
                     V20  Q0,0   20,0
                     H200"
                  stroke="#4caf50" stroke-width="10" fill="none" vector-effect="non-scaling-stroke"
                  stroke-linecap="butt"
                  stroke-dasharray="0 0" stroke-dashoffset="0"/>
          </svg>
          <div id="timerMessage"></div>
          <p id="timeDisplay">0h00m00s<small>00</small></p>
          <textarea class="commonArea" id="timerMemo" rows="1" maxlength="100" placeholder="メモ（最大100文字）"></textarea>
        </div>
        <div id="timerControls">
          <div class="control-left">
            <button class="btn-timer main" onclick="startTimerBL()" id = "startBtn">スタート</button>
            <button class="btn-timer main" onclick="stopTimerBL()" id = "stopBtn" style="display: none">ストップ</button>
            <button class="btn-timer main" onclick="startTimerBL()" id = "resumeBtn" style="display: none"><ruby>再開<rt>さいかい</rt></ruby></button>
            <button class="btn-timer save" onclick="saveTimerBL()" id = "saveBtn" style="display: none"><ruby>登録<rt>とうろく</rt></ruby></button>
          </div>
          <div class="control-right">
            <button class="btn-timer reset" onclick="resetTimer()" id = "resetBtn" style="display: none">リセット</button>
          </div>
        </div>
      </div>
      <!-- 右側：上位記録 -->
      <div class="rankColumn">
        <h3><ruby>上位記録<rt>じょういきろく</rt></ruby>（トップ3）</h3>
        <ul id="topTimesList"></ul>
        <div id="timerBackControls">
          <button class="btn-nav" onclick="showPage('actSelectPage')">← <ruby>戻<rt>もど</rt></ruby>る</button>
          <button class="btn-nav" onclick="backToRecordListPage()"><ruby>記録一覧<rt>きろくいちらん</rt></ruby>へ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 活動記録選択画面 -->
  <div id="actHistoryPage" class="page">
    <h2><ruby>活動記録<rt>かつどうきろく</rt></ruby>の<ruby>選択<rt>せんたく</rt></ruby></h2>
    <ul id="actHistoryList"></ul>
    <button class="btn-nav" onclick="showPage('homePage')">← <ruby>戻<rt>もど</rt></ruby>る</button>
  </div>

  <!-- 活動毎の記録一覧 -->
  <div id="recordListPage" class="page">
    <div class="recordListHeader">
      <h2 id="recordListTitle">活動名の記録</h2>
      <div class="sortControls">
        <select id="sortSelector"></select>
        <button class="btn-select" id="sortBtn" onclick="sortRecords()">ソート</button>
      </div>
    </div>
    <ul id="recordList"></ul>
    <div class="recordBtnControls">
      <button class="btn-nav" onclick="showPage('actHistoryPage')">← <ruby>戻<rt>もど</rt></ruby>る</button>
      <button class="btn-nav" onclick="backToTimerPage()">タイマー<ruby>画面<rt>がめん</rt></ruby>へ</button>
      <button class="btn-nav" onclick="changeRecViewBtn()" id="chngRecViwBtn">メモ表示</button>
    </div>
  </div>

  <!-- 記録詳細画面 -->
  <div id="recordDetailPage" class="page">
    <h2 id="recordDetailTitle">活動名の記録詳細</h2>
    <p><strong><ruby>日付<rt>ひづけ</rt></ruby>：</strong><span id="detailDate"></span></p>
    <div class="rank-time-row">
      <p><strong><ruby>順位<rt>じゅんい</rt></ruby>：</strong><span id="detailRank"></span></p>
      <p><strong><ruby>記録<rt>きろく</rt></ruby>：</strong><span id="detailTime"></span></p>
    </div>
    <label for="detailMemo"><strong>メモ（最大100文字）：</strong></label>
    <textarea class="commonArea" id="detailMemo" rows="5" maxlength="100" readonly></textarea>
    <div id="memoControls">
      <div id="memoLeftButton">
        <button class="btn-nav" onclick="showPage('recordListPage')">← <ruby>戻<rt>もど</rt></ruby>る</button>
      </div>
      <div id="memoRightButton">
        <button class="btn-sub" onclick="editMemo()" id = "editMemoBtn">メモ<ruby>編集<rt>へんしゅう</rt></ruby></button>
        <button class="btn-sub" onclick="cancelEditedMemo()" id = "cancelMemoBtn" style="display: none">キャンセル</button>
        <button class="btn-sub" onclick="saveEditedMemoBL()" id = "saveMemoBtn" style="display: none">メモ<ruby>保存<rt>ほぞん</rt></ruby></button>
      </div>
    </div>
  </div>

  <!-- ポップアップ時の画面制御用 -->
  <div id="overlay"></div>

  <!-- 共通モーダル画面 -->
  <div id="modal" class="modal">
    <div class="modalContent">
      <span id="modalClose" class="close" onclick="closeModal()">&times;</span>
      <h2 id="modalTitle"></h2>
      <div id="modalBody"></div>
      <div id="modalFooter"></div><!-- 必要に応じてボタン追加 -->
    </div>
  </div>

  <!-- js 最後に書くことでhtmlの読み込みを優先(グローバルボタン読み込み)※mainにインポートしたクラスは不要 -->
  <script type="module" src="./main.js"></script>
  <script type="module" src="./authHandler.js"></script>
</body>
</html>
